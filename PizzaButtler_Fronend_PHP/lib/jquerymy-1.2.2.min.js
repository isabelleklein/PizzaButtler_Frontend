/* jQuery.my 1.2.2
 * Requires jQuery 1.11.0+, SugarJS 1.3.9-1.4.x
 * More details at jquerymy.com */
!function(e){function t(){window.console&&console.error.apply(console,arguments)}function r(){window.console&&console.log.apply(console,arguments)}function n(e,t){return e.hasOwnProperty(t)}function i(t){return e.contains(document.documentElement,t[0])}function a(e,t){return Array.prototype.slice.call(e,t||0)}function o(e,t,r){var n=0,i=e.length,a=!0;if(e===t)return"===";if("==="==r)return"";if(i!=t.length)return"";for(;i>n&&a;n++)a=e[n]===t[n];if(a)return"==";if("=="==r)return"";for(a=!0;i>n&&a;n++)a=Object.equal(e[n],t[n]);return a?"=":""}function s(e,t){return(oe(t)?t.split("."):ie(t)?t:[""]).reduce(function(e,t){if(null!=e){if(/=/.test(t)){var r=t.split("=",2);return se(e)?Object.values(e).find(function(e){return se(e)||ie(e)?e[r[0]]==r[1]:!1}):ie(e)?e.find(function(e){return se(e)||ie(e)?e[r[0]]==r[1]:!1}):void 0}if(null!=e&&null!=e[t])return e[t]}},e)}function l(e){var t=e.my();return t?t.root?t.root.my():t:null}function c(e){var t,r={},n=function(){return null};if(oe(e))e.split(/[,\s]+/).compact(!0).unique().map(function(e){r[e]=n});else if(ie(e))e.compact(!0).unique().map(function(e){r[e]=n});else if(se(e))for(t in e)ue(e[t])?r[t]=e[t]:r[t]=function(){return e[t]};return r}function u(e){var t,r=e,n={};if(oe(r)&&(r=r.split(/[,\s]+/)),ie(r)){for(r=r.compact(!0),t=0;t<r.length;t++)n[r[t]]=!0;return n}return se(r)?e:null}function d(e){for(var t=JSON.stringify(e),r=0,n=0;n<t.length;n++)r=t.charCodeAt(n)+(r<<6)+(r<<16)-r;return(1e11+r).toString(36)}function f(e,t){for(var r in t)n(t,r)&&(se(t[r])?n(e,r)?f(e[r],t[r]):e[r]=ye(t[r],!0):n(e,r)||(ie(t[r])?e[r]=t[r].clone(!0):e[r]=t[r]));return e}function m(e,t){function r(e,t,n){return void 0===n||null===n?t:se(n)?he(t,n,!1,r):n}return e?t?he(e,t,!1,r):e:{}}function h(e,t){return pe(e).forEach(function(t){delete e[t]}),"object"==typeof t&&he(e,t,!0),e}function y(e,t){var r,n;return oe(e)?(r=e,n=s(se(t)?t:fe,r),"exist"===t?se(n):n?ye(n,!0):null):se(e)?(n=v(e,t),se(n)?n:null):void 0===e?fe._src:null===e?Object.reject(fe,/^_/):null}function p(e,t){var r,n;if(se(t))return t;if(oe(t)){if(r=s(e,t),null==r&&(r=ye(fe._src[t],!0)),null==r&&(r=s(fe,t),se(r)&&se(r._self)?r=ye(r._self,!0):se(r)&&(r=ye(r,!0))),null==r&&s(e,"params.cache")&&(n=s(e,"params.cache"),ue(n)?r=n(t):se(n)&&(r=je(t,n)),se(r)&&(se(r._self)&&(r=ye(r._self,!0)),he(r,{params:{cache:n}},!0))),null!=r&&se(r))return n=n||s(e,"params.cache"),n&&he(r,{params:{cache:n}},!0),r;throw"Component "+t+" not found."}return ue(t)?t.apply(e,a(arguments,2)):null}function v(r,i){var a,o,l,c,u,d=i||fe,f=r;if(!(se(d)&&se(f)&&se(f.ui)&&oe(f.id)))return"Can’t save manifest into cache, invalid arguments.";n(d,"_src")||(d._src={}),l=f.id;try{f=ye(r,!0)}catch(m){return"Can’t save circular-referencing object into cache."}try{(!f.params||f.params&&!f.params.strict)&&U(f,!0)}catch(m){return"Invalid manifest, parse error."}if(a=g(f),oe(a))return t(a),a;if(he(f,{params:{strict:!0}},!0),d._src[l]=f,c=N(d,l)){if(c.params&&c.params.protect)return"Can’t save manifest into cache over protected one.";c._self&&delete c._self,e.extend(!0,d,_("",l))}return e.extend(!0,d,_(f,l)),o=Object.keys(d._src).filter(function(e){return e.startsWith(l+".")}),o.sort(),o.forEach(function(t){var r;(r=N(d,t))&&(r._self&&delete r._self,e.extend(!0,d,_("",t))),e.extend(!0,d,_(d._src[t],t))}),u=s(d,l),V?u._self=d._src[l]:Object.defineProperty(u,"_self",{get:function(){return d._src[l]},set:function(){throw"Can’t change manifest cache entry directly."},enumerable:!1,configurable:!0}),u}function g(e){var t,r,n=[];if(se(e.files)&&Object.size(e.files))for(t in e.files){if(r=e.files[t],!se(r))return"Non-object member "+t+" in files section.";if(oe(r.data)&&!r.url)if(W)try{Ne.base642blob(r.data,function(e){r.blob=e,r.url=W.createObjectURL(r.blob)},r.content_type||r.mime),n.push(t)}catch(i){return"Invalid base64 data in files/"+t+"."}else r.url="data:"+(r.content_type||r.mime)+";base64,"+r.data,n.push(t)}return n}function b(e,t,r,n){var i,a=[],o=r.bind,s=be(o);return s==te?o.call(l(n).manifest,e,t,n):s===ee||s===Z?s!==ee||/\./.test(o)?(a=s===ee?o.split("."):o,"this"===a[0]?(i=l(n).manifest,a.shift()):i=e,q(i,t,a,!0)):(t!=xe?e[o]=t:void 0===e[o]&&(e[o]=xe),e[o]):xe}function x(n,i,a,o){function l(){var t=null,r=j.manifest;if(ue(r)||se(r)&&se(r.ui)?g=r:oe(r)&&(g=p(z,r.replace(ne,""))),g&&oe(j.bind)){var i=s(ne.test(j.bind)?z:x.data,j.bind.replace(ne,""));if(null===C&&(C=ge()),ie(i)||j.list){n.addClass("my-form-list");var a="",l=">*";if(/^<.+>$/.test(j.list)?a=j.list:l=j.list||l,!a){var d=n.find(l);a="<div></div>",d.size()&&(a=e(a).append(d.eq(0).clone(!0)).html(),d.eq(0).remove())}n.data("formlist")||n.data("formlist",{}),n.data("formlist").generator={manifest:g,delay:(j.delay||w.delay||10)/1.3,template:a,selector:l,parent:z,bind:j.bind,merge:ue(j.merge)?j.merge.bind(z):j.merge?m:!1,hash:ue(j.hash)?j.hash.bind(z):oe(j.hash)?u.fill(void 0,j.hash):ie(j.hash)?f.fill(void 0,j.hash.slice(0)):null,id:ue(j.id)?j.id.bind(z):oe(j.id)?u.fill(void 0,j.id):ie(j.id)?f.fill(void 0,j.id.slice(0)):null,ext:!(!j.id&&!j.hash),stamp:0},n.on("insert.my",function(t,r){t.stopPropagation();var n={what:void 0,where:0};null==r?n.where=1e6:se(r)?he(n,r):(oe(r)||le(r))&&(n.where=r),e(t.target).my("insert",n.where,n.what)}),n.on("remove.my",function(t){t.stopPropagation(),e(t.target).my("remove")})}else try{t=M.call(n,p(z,g),se(i)?i:void 0)}catch(y){c("$.my subform init of "+o+" failed: "+y.message,y.stack)}}de(t)?t.then(h,function(e,t){c("Init of subform "+o+" failed with error: "+e,t)}):h()}function c(e,r){t(e,r),C&&C.reject(e,r)}function u(e,t){var r=s(e,t)||"";return"string"==typeof r?r:d(r)}function f(e,t){return d(N(e,t))}function h(){n.each(function(){var t,r,s,l=e(this),c=!1;if("TEXTAREA"==l[0].nodeName&&(s=l[0].nextSibling,r=s&&s.CodeMirror?s.CodeMirror:null,r&&l.addClass("my-codemirror")),t=j.events||$(l,ze.events),l.hasClass("my-form")?ve(l.data("my"),{dui:j,root:i,selector:o,dparams:w,devents:t,ddata:x.data,container:w.container(l),derrors:x.errors,single:!0}):(l.data("my",{events:t,selector:o,initial:v,previous:v,root:i,container:w.container(l),id:x.id,ui:j,data:x.data,params:w,errors:x.errors,single:1==_}),a._update=j.delay?F.debounce(j.delay):xe,c=!0),c)if(l.cleditor&&l.parent().hasClass("cleditorMain")){var u=l.cleditor()[0];if(u&&u.$frame&&u.$frame[0]){l.addClass("my-cleditor"),ve(l.data("my"),{container:w.container(l)});var d,f=function(e){l.val(e).trigger(re)},m=Number.random(1e5,1e6-1);e(u.$frame[0]).attr("id","cleditCool"+m),d=document.frames?document.frames["cleditCool"+m].document:e("#cleditCool"+m)[0].contentWindow.document;var h=e(d).find("body");e(d).bind("keyup.my",function(){f(e(this).find("body").html())}),l.parent().find("div.cleditorToolbar").bind("click.my mouseup.my",function(){f(h.html())}),e("body").on("click","div.cleditorPopup",function(){f(h.html())})}}else if(l.is("div.redactor_box textarea")){var y,p="my-redactor-9";try{y=l.getEditor(),p="my-redactor-8"}catch(g){y=l.redactor("getEditor")}y&&(l.addClass(p),y.bind("input.my keyup.my blur.my",function(e){e.trigger("redactor")}.fill(l)))}else l.hasClass("ace_editor")?ace.edit(n[0]).on(re,function(e){e.trigger("ace")}.fill(l)):r&&r.on(re,function(e){e.trigger("codemirror")}.fill(l));l.my()._changed=k.debounce(b),l.my()._recalc=S.debounce(b),l.bind(t,function(e){e.type==re&&e.stopPropagation(),c&&(x.locktill=Ce()+a.delay),l.my()._changed(l,i,a,w)}),/check(\.my)?/.test(t+"")||l.on("check.my",function(e){return l.my()._changed(l,i,a,w,!0),!1}),c||l.off("redraw.my"),l.on("recalc.my, redraw.my",function(e){e.stopPropagation(),l.my()._recalc(l,i,a,w)})}),C&&C.resolve()}var y,v,g,b,x=i.my(),w=(x||{}).params,j=a,C=null,O=0,z=x.manifest,_=n.size();return x?(b=a.delay,_?(j.init!=xe&&(y=T(z,j.init,n,x)),de(y)?(O+=1,C=ge(),y.then(l,function(e,t){c("Init of "+o+" failed: "+e,t)})):l()):r("Not found "+o+" selector.",i),C):(t("Failed to find $root building "+o+" selector."),null)}function w(r,n){se(n)&&n.channel&&n.message&&r.find(".my-listen-"+d(n.channel)).each(function(){var r,i=e(this),a=i.data("my"),o=void 0;if(a&&a.ui.listen&&ue(a.ui.listen[n.channel])){r=a.ui.listen[n.channel];try{o=r.call(a.manifest||a.root.my().manifest,a.data,n.message,i)}catch(s){t("Listener failed",s.message,s.stack)}void 0!==o&&(null===o?i.trigger("check"):o&&i.trigger("recalc"))}})}function k(e,t,r,n,i){var a,o=e.data("my");t.data("my");o&&(o.disabled?o.ddata||F(e,xe,r.recalcDepth||n.recalcDepth):(z(o.ddata||o.data,o.dparams||o.params),i||(a=o.single?e:t.find(o.selector)),F(e,i?xe:O(a,xe),r.recalcDepth||n.recalcDepth),n.change&&n.change.call(e)))}function j(t,r,n){var i=n.compact(),a=i.replace(/:disabled/g,""),o=a!==i,s="self:"===a.to(5);return s&&(a=a.replace(/^self:/g,"")),r.each(function(){var n=e(this),i=n.my(),l=!s&&i?i.container:n;l.toggleClass(a,!!t),o&&void 0!==i&&!!t!=!!i.disabled&&(n.my().disabled=!!t,i._disable||(n.my()._disable=$(r,ze.offon).fill(void 0,r)),i._disable(!!t))}),r}function C(e,t,r){return e[t](r?"disable":"enable")}function O(e,t){var r,n,i=e.data("myval");return i||(n=$(e,ze.vals),ue(n)&&(r=n(e,xe),void 0===r?e.data("myval",function(e,t){return xe!=t&&n(e,t),e.val()}.fill(e,void 0)):e.data("myval",n.fill(e,void 0))),i=e.data("myval")),ue(i)?(r=i(),(r!==t&&(0==t||0==r)||r!=t||se(t))&&(r=i(t)),r):xe}function z(e,t,r,n){var i,a,o,s,l,c,u,d,f,m=t;if(!se(m)||isNaN(s=m.remember)||!se(i=m.history))return xe;if(se(e)&&s){if(c=ye(e,!0),u=Ce(),o=pe(i).sort(),o.length&&(u-o.last()<m.historyDelay||Object.equal(i[o.last()],c)))return xe;if(m.history[u]=c,o.push(u),o.length>=2*s){for(f={},a=s;2*s>a;a++)f[o[a]]=i[o[a]];t.history=f}return n||m.form.trigger(re),m.history[o.last()]}if(!isNaN(e)||e===xe){if(l=parseInt(e)||0,0>l)return xe;if(o=pe(i).sort(),l>=o.length&&(l=o.length-1),d=ye(m.history[o[o.length-l-1]],!0),r){for(f={},a=0;a<o.length-l-1;a++)f[o[a]]=i[o[a]];t.history=f}return n||m.form.trigger(re),d}return n||m.form.trigger(re),xe}function N(e,t){function r(e,t){if(!se(t))return{};var i={};for(var a in t)!se(t[a])&&n(e,a)?i[a]=ye(e[a],!0):n(e,a)&&(se(e[a])?i[a]=r(e[a],t[a]):i[a]=ye(e[a],!0));return i}if(!se(e))return null;var i,a=t;if(oe(a))return s(e,a);if(ie(a)){i=[];for(var o=0;o<a.length;o++)i[o]=oe(a[o])?s(e,a[o])||null:null;return i}return se(a)?r(e,a):void 0}function _(e,t,r){var n,i,a;if(null==r?(n={},i=e,a=t):(n=e,i=t,a=r),se(i)&&se(a))return N(i,a);if(oe(a)&&(a=[a],i=[i]),!ie(a)||!ie(n)&&!se(n))return null;if(se(i)&&(i=a.reduce(function(e,t){return e.push(s(i,t)),e},[])),ie(i)&&ie(a)){for(var o=0;o<a.length;o++)null!=i[o]&&q(n,i[o],a[o]);return n}return null}function q(e,t,r,n){var i,a,o,s,l=0;if(oe(r)&&!/\./.test(r))null!=t&&(e[r]=t);else for(a=ie(r)?r:(r+"").split("."),i=e,s=a.length-1;s>=l;l++)if(l===s){if(n)return xe!=t?i[a[l]]=t:void 0===i[a[l]]&&(i[a[l]]=xe),i[a[l]];i[a[l]]=t}else 0===l?(i=e[a[0]],o=e):(o=o[a[l-1]],i=i[a[l]]),(null==i||!se(i)&&(ie(i)&&!isNaN(a[l+1])&&+a[l]>-1))&&(i=o[a[l]]={});return e}function D(e,t,r){var i=se(t)?t:null;return Object.each(e,function(t,r){var n=typeof r;/^str|^fu/.test(n)&&(e[t]={bind:r})}),Object.each(e,function(t,a){var o,l,u,d=[],f=[],m=/\s?[,;]\s?/;a.recalc&&(oe(a.recalc)?d=a.recalc.split(m):ie(a.recalc)&&(d=a.recalc),d=d.compact(!0).unique()),d.length&&(e[t].recalc=d),null==a.bind&&(a.bind=function(){});var h;if(a.listen&&(h=c(a.listen),Object.size(h)?a.listen=h:a.listen=void 0),n(a,"watch"))for(oe(a.watch)?f=a.watch.split(m):ie(a.watch)&&(f=a.watch.slice(0)),f=f.compact(!0).unique(),u=0;u<f.length;u++)(o=e[f[u]])&&(l=o.recalc,l?oe(l)?o.recalc+=","+t:ie(l)&&-1==l.indexOf(t)&&o.recalc.push(t):o.recalc=[t]);null!==i&&["css","check","manifest","list","hash","id"].each(function(e){if(oe(a[e])){var t=s(i,a[e].replace(ne,""));null==t||oe(t)||(a[e]=t)}}),a.delay=isNaN(a.delay)?r.delay:a.delay-0}),e}function T(e,t,r,n){var i;if(oe(t)){if(i=s(e,t),void 0===i)return r.html(t.assign(n.data)),null}else i=t;if(ue(i))return i.apply(e,a(arguments,2));if(ie(i))try{r.formgen(i)}catch(o){}return null}function S(e,t,r,n){var i=e.my();if(i&&!i.disabled){var a=t.find(i.selector);a.is(".my-form")?a.my("redraw"):F(e,a.is(".my-form-list")?s(a.my().data,a.data("formlist").generator.bind):xe,r.recalcDepth||n.recalcDepth)}}function E(t,r){function n(t,r){var n;return oe(t)?/[\/]/.test(t)?(n=ve(!0,{},j,{ref:r,ajax:{url:t}}),ne.test(r)&&(n.ajax.dataType="json")):t.length&&(n=ve(!0,{},j,{ref:r,ajax:t})):se(t)&&(n=ve(!0,{},j,{ref:r,ajax:e.extend(!0,{},Object.select(t,["accepts","async","cache","data","dataType","xhrFields","password","timeout","type","url","username","headers"]))}),n.ajax.url||(n=null)),n}function i(){g.reject(w)}function a(){C+=1;var e=b[C];if(e)o(e).then(a).fail(i);else{var r=c(x),n=pe(Object.findAll(r,function(e,t){return!t}));n.length&&w.push((1===n.length?"Key "+n[0]+" is":"Keys "+n.join(", ")+" are")+" not present after all."),w.length?i():g.resolve(t)}}function o(e){function r(){l-=1,o?s.reject():.5>l&&s.resolve()}var n,i,a,o=!1,s=ge(),l=e.length;for(i=0;l>i;i++)n=e[i],a=oe(n.ajax)?k.loader:ke,a(n.ajax).then(function(e,n){ne.test(n.ref)&&(null!=e?ve(!0,t,_(e,n.ref.from(5))):(o=!0,w.push("Invalid data for ‘"+n.ref+"’ resource."))),r()}.fill(void 0,n)).fail(function(e,t){w.push("Failed to load ‘"+t.ref+"’ resource."),o=!0,r()}.fill(void 0,n));return s.promise()}function l(e){var r=!1;return ne.test(e)?null!=s(t,e.from(5))&&(r=!0):null!=s(window,e)&&(r=!0),r}function c(e){for(var t in e)e[t]===!1&&(e[t]=l(t));return e}var u,d,f,m,h,y,p,v,g=ge(),b=[],x={},w=[],k=ve(!0,{ajaxTimeout:1e4,loader:ze.params.loader},r||{}),j={ref:null,ajax:{type:"GET",async:!0,timeout:k.ajaxTimeout}};if(se(t))if(ie(t.require)){for(m=t.require,u=0;u<m.length;u++)if(h=m[u],oe(h))x[h]=l(h);else if(se(h)){v=[];for(d in h){if(y=null,h[d]===!0)x[d]=l(d);else if(oe(h[d])||se(h[d]))y=n(h[d],d);else if(ie(h[d])){for(y=[],f=0;f<h[d].length;f++)(oe(h[d][f])||se(h[d][f]))&&(p=n(h[d][f],d),p&&y.push(p));y.length||(y=null)}y&&!(x[d]=l(d))&&v.add(y)}v.length&&b.push(v)}var C=-1;a()}else g.resolve(t);else g.reject(["Invalid manifest."]);return g.promise()}function M(n,i,a){function o(){var e=!0;h(),K.files&&(e=p()),e&&(y(),v())}function l(e){var t,r,n,i,a,o,l={},c=!0,d=e.inherit;if(l=u(d),!Object.size(l))return null;if(i=ye.parents(".my-form").eq(0),!i.size())return null;if(a=i.data("my"),!a||!a.manifest)return null;n=a.manifest,r=n.expose,c=!r;for(t in l)(c||r[t])&&(o=s(n,t),null!=o&&(/\./.test(t)||oe(l[t])?ve(!0,L,_(o,oe(l[t])?l[t]:t)):e[t]=o))}function m(){var e,r;for(e in te)for(r in $[e].listen)te[e].addClass("my-listen-"+d(r));K.radio&&ye.on("radio.my",function(e,r){var n,i;if(se(r)&&r.channel&&r.message&&ue(K.radio[r.channel])){n=K.radio[r.channel];try{i=n.call(K,e,r)}catch(a){t("Radio handler for form "+E+" failed",a.message,a.stack)}void 0!==i&&(e.stopPropagation(),i&&w(ye,r))}})}function h(){F.strict||ue(L.init)||U(L,!0),K=ve(!0,K,Object.reject(L,["data"])),$=D(ve(!0,{},L.ui||{}),K,F),K.radio&&(K.radio=c(K.radio)),K.expose&&(K.expose=u(K.expose)),S=Number.random(268435456,4294967295).toString(16),q=L.id||"my"+S,E=d(q),K.id=q,F.form=ye,L.params&&L.params.depth&&(F.recalcDepth=L.params.depth);for(A in K)ue(K[A])&&(K[A]=K[A].bind(K));V?K.my=I(ye):Object.defineProperty(K,"my",{get:function(){return null==Z&&(Z=I(ye)),Z},enumerable:!1}),L.error&&(oe(K.error)?ae=function(e,t){return K.error.assign(ve({message:e+"",err:t+""},K))}:ue(L.error)&&(ae=function(e,t){M=null;try{M=L.error(e,t)}catch(r){M=F.messages.initFailed}return M})),ve(ye.data("my"),{id:q,cid:S,mid:E,errors:Object.extended(),ui:Object.extended($),disabled:!1,manifest:K,locFiles:[],modals:{},radio:{}}),ye.addClass("my-form"),H="my-manifest-"+E,J="my-form-"+S,ye.addClass(J+" "+H)}function y(t){function r(e,t){return'<style id="'+t+'" data-count="0">.'+t+e.join(" \n."+t)+"\n</style>"}!K.style||t&&!ye.is(":visible")||(P=R(ye,K,H,J),P&&P[0].length&&!t&&(B=e("style#"+H),B.size()||(B=e(r(P[0],H)).appendTo(e("body"))),B.data("count",1*B.data("count")+1),ye.data("my").style=B),P&&P[1].length&&(Q=e("style#"+J),Q.size()?t&&(e(r(P[1],J)).replaceAll(Q),Q=e("style#"+J)):(Q=e(r(P[1],J)).appendTo(e("body")),F.restyle>-1&&!me[S]&&(me[S]=function(){y(!0)}.debounce(F.restyle)),ye.data("my").restyle=y.fill(!0).debounce(0)),ye.data("my").localStyle=Q,t||ye.addClass("my-restyle")))}function p(){var e,t,r=!0;if(t=g(K),oe(t))C("Error decoding base64 to local Blob/URL",t),r=!1;else{if(W)for(e=0;e<t.length;e++)ee.push(K.files[t[e]].url);ee.length&&(ye.data("my").locFiles=ee)}return r}function v(){if(L.init!=xe){fe=ye.find(">*").clone();try{X=T(K,L.init,ye,L)}catch(t){return C(oe(t)?t:t.message,t.stack),ye}}if(de(X)?X.then(function(){k()},function(e,t){C(e,t)}):k(),!ne){if(!ye.my())return C("Internal error initializing controls.",""),ye;ye.data("my").initial=ve(!0,{},G),e.mobile&&e.mobile.changePage(e.mobile.activePage)}}function k(){function e(e){ne||(t[e]=O(ye.find(e),xe),r-=1,.5>r&&j(t))}var t={},r=Object.size($);ye.addClass(le),Object.each($,function(t){if(!ne){var r=ye.find(t),n=x(r,ye,$[t],t);he[t]=r,de(n)?n.then(e.fill(t)).fail(function(e,r){C("Error building "+t+", "+e,r)}):ne||e(t)}})}function j(e){var r,n,i,a,o;for(o in $){if(ne)return;if(r=$[o],i=he[o],a=i.size()){r.listen&&(te[o]=i.eq(0));try{n=b(G,xe,r,i),n==xe&&e[o]!=xe&&void 0!==n&&b(G,e[o],r,i)}catch(s){t("Transient fail linking "+o+" of form $('.my-form-"+S+"')",s.message,s.stack)}try{n!=xe&&O(i,n),i.eq(0).trigger("check.my")}catch(s){C("Error linking "+o,s.message,s.stack)}}}ye.removeClass(le),ye.on("recalc.my, redraw.my",function(e){e.stopPropagation(),ye.my("redraw")}),fe=null,re.resolve(G)}function C(e,r){var n;if(ne=!0,t("Form "+q+" failed to initialize.",e,r),Object.keys(he).forEach(function(e){delete he[e]}),ye.removeClass(le),n=ae(e,r),oe(n)||se(n)&&n.jquery?ye.html(n):n===!0&&ye.html(fe),F.silent)re.resolve(G);else{if(!ye.my().ddata){if(ye.removeData("my"),ye.removeClass("my-form"),B)if("1"==B.data("count"))try{B.remove()}catch(i){}else B.data("count",B.data("count")-1);if(Q)try{delete me[S],Q.remove()}catch(i){}}re.reject("Form "+q+" failed to initialize: "+e,r)}}var z,N,q,S,E,M,$,F,L,A,P,H,J,B,Q,X,K={},G={},Z=null,ee=[],te={},re=ge(),ne=!1,ae=function(){},le="my-form-init",ce="std",fe="",he={};if(oe(n)){if(z=je(n),!z)return re.reject("No manifest with id "+n+" found in repo."),re.promise();se(a)&&se(i)?(z=ve(z,i),N=a):N=i,ce="repo"}else z=n,N=i;if(!z)return this;L=se(N)&&"repo"!=ce?ve(!0,{},z):z;var ye=this.eq(0),pe=ye.my();return se(pe)&&pe.id&&pe.ui?(r("jQuery.my is already bound.",ye),ye.my("ui",L.ui),ye.my(Y,L.data),re.resolve(ye.my(Y)).promise()):(F=L.params||{},F.strict||ue(L.init)||(F=ve(!0,{},F),U(F)),F=ve(!0,{},ze.params,F),re.fail(function(){ye.removeClass(J+" "+H)}),ve(ye,re.promise()),se(N)?(G=f(N,L.data||{}),L.data=G):G=L.data||{},K.data=G,ye.data("my",{data:G,params:F,promise:re.promise(),locktill:0}),ye.addClass(le),L.inherit&&l(L),ie(L.require)?Oe(L,F).then(o).fail(function(e){h(),C("Linker of the ‘require’ property failed.",e)}):o(),re.then(m),ye)}function R(e,t,r){function n(r,a,o,s){var l,c,u,d,f=r;if(oe(f)&&(/[\r\n]/.test(f)||f.split("}",3).length>2?f=Ne.css2json(f):o.push(a+(/\{/.test(f)?f:"{"+f+"}"))),ie(f)&&f.length)for(l=0;l<f.length;l++)n(f[l],a,o,s);else if(se(f))for(l in f)for(d=i(a,l),c=0;c<d.length;c++)n(f[l],d[c],o,s);else if(ue(f))try{u=f.call(t,e,t),n(u,a,s,s)}catch(m){}}function i(e,t){var r,n="",i=t+"";return(" "===i.to(1)||/^[a-z]/i.test(i))&&(n=" "),r=i.split(/\s*,\s*/).compact(!0),r.length||r.push(""),r.map(function(t){return e+n+t})}var a=[],o=[],s=t;return se(s)&&se(s.style)?(n(t.style,"",a,o),[a,o]):""}function I(t){function r(r,n,a){var o=r?oe(r)?t.find(r):e(r):t;return i(o)?o.trigger(n,a):void 0}var n={ajax:function(){return ke.apply(this,a(arguments))},cancel:r.fill(void 0,"cancel"),check:r.fill(void 0,"check"),commit:r.fill(void 0,"commit"),insert:function(e,t,n){var i="insert",a=!0;if(se(n)?r(e,i,{where:t,what:n}):oe(e)?null==t&&null==n?r(t,i):se(t)?r(e,i,{where:1e6,what:t}):a=!1:se(e)&&(e.where&&e.what?r(null,i,e):r(null,i,{where:1e6,what:e})),!a)throw"Invalid insert"},modal:function(e,r){var n,i;return oe(e)?(n=t.find(e),i=r,i.root||(i.root=t)):(n=t,i=e),n.modal(i)},now:Ce,parent:function(e){var r=t.parents(".my-form");return r.size()?r.eq(0).my("manifest"):null},recalc:r.fill(void 0,"recalc"),root:function(){return t},trigger:r,val:function(e){return _e.val.apply(t.find(e),a(arguments,1))}};return qe.forEach(function(e){"init"==e||n[e]||(n[e]=_e[e].bind(t))}),n}function $(e,t){function r(e,t,o){for(var s in t)if(""!=s&&e.is(s)){a=a+(a?" ### ":"")+s;var l=t[s],c=be(l);if(!/^(nul|un|ob)/.test(c)&&o>i)return n=l,void(i=o);c==G&&r(e,l,o+1)}xe!=t[""]&&typeof t[""]!=G&&o>i&&(n=t[""],i=o)}var n=xe,i=0,a="";return r(e,t,1),n}function F(e,r,n){var i,a,o,s,l,c,u,d,f,m,h,y,p=!1,v=!1,g=e,x=g.my(),w="";if(x){if(f=x.selector,m=x.root,m.hasClass("my-form-init"))return{};if(h=m.find(f),y=m.my().ui,p=e.hasClass("my-form"),v=e.hasClass("my-form-list"),p?(a=e,o=x.ddata,s=x.dui,l=x.dparams):(a=x.container,o=x.data,s=x.ui,l=x.params),s.bind!=xe){if(c=we(r)?r:O(h,b(o,xe,s,h)),xe!=s.check){w="Unknown error";try{w=J(o,c,s,h)}catch(k){t("Error "+k.message+" in .check validator for "+f,m,k.stack)}}var C=l.errorCss,z="ui-state-error";try{xe!=r&&(c=O(h,b(o,r,s,h)))}catch(k){w=l.messages.formError||"Error"}if(""==w&&a.hasClass(C))p?x.derrors[f]="":x.errors[f]="",a.removeClass(C),a.attr("title")&&a.attr("title",""),p||v||l.effect(a.find(l.errorTip),!1,l.animate/2),g.removeClass(z),g.find(".ui-widget").removeClass(z);else if(w){if(p)x.derrors[f]=w;else if(v)x.errors[f]=w;else{a.addClass(C),x.errors[f]=w;var N=a.find(l.errorTip).eq(0);N.size()?l.effect(N.addClass(C).html(w),!0,l.animate):a.attr("title",(w||"").stripTags())}g.hasClass("hasDatepicker")&&(g.is("input")?g.addClass(z):g.find(".ui-widget").addClass(z)),g.hasClass("ui-slider")&&g.addClass(z)}}var _=r==xe?c:r;if(s.css)for(u in s.css)d=s.css[u],ce(d)?j(d.test(_),h,u):ue(d)&&j(d.call(m.my().manifest,o,_,h),h,u);var i,q,D=s.recalc,T=[],S={};if(n&&s.recalc&&m.my()){for(y=m.my().ui,i=0;i<D.length;i++)D[i]&&oe(D[i])&&(q=D[i].compact())&&y[q]&&(y[q].recalc?-1===T.indexOf(q)&&T.push(q):S[q]=!0);for(i=0;i<T.length;i++)S=ve(!0,S,F(m.find(T[i]),xe,n-1));if(r!==xe){for(i in S)S[i]===!0&&i!=f&&(y[i].delay&&!y[i].recalc?y[i]._update(m.find(i),xe,n-1):F(m.find(i),xe,n-1));return{}}}return S||{}}}function U(e,t){var r,i=!t;for(r in e)n(e,r)&&L(r,e,i)}function L(e,r,n){var i,a,o,s,l="";(n||!/^(data|files|require)$/.test(e))&&(i=r[e],l=be(i),/^(ob|ar)/.test(l)?U(i):"string"===l&&/^(function[\s\n\t]+|new\sRegExp)/.test(i)&&((a=i.match(/^function([\s\n\t]+[\w_$][\w\d_$]*)?[\s\n\t]*\(([^\)]*)\)\s*\{([\s\S]*)\}[\s\n\r\t]*$/))&&4===a.length?(s=a[1]?a[1].replace(/[\s\n\t]/g,""):"",o=s.length?P(s,a[2],a[3]):A(a[2],a[3]),"function"==typeof o?r[e]=o:t("Invalid function in XJSON, skipped",o.message,o.stack,i)):(a=i.match(/^new\sRegExp\s*\(\/([\s\S]+)\/([a-z]*)\)$/))&&3===a.length&&(o=H(a[1],a[2]),"function"==typeof o.test?r[e]=o:t("Invalid RegExp in XJSON, skipped",o.message,o.stack,i))))}function A(e,t){var r;try{r=new Function(e,t)}catch(n){r={message:n.message,stack:n.stack}}return r}function P(e,t,r){var n;try{n=new Function("","return (function "+e+"("+t+"){"+r+"});")()}catch(i){n={message:i.message,stack:i.stack}}return n}function H(e,t){var r;try{r=new RegExp(e,t)}catch(n){r={message:n.message,stack:n.stack}}return r}function J(t,r,n,i){var a,o,s,c,u=n.check;if(u!=xe){var d=l(i).params.messages,f=n.error,m=f||d.patternMismatch||d[""]||"Error";if(i.size()&&Object.prototype.hasOwnProperty.call(i[0],"validity")&&!i[0].validity.valid){var h=i[0].validationMessage+"";if(""!==h)return h.substr(0,1).toUpperCase()+h.substr(1);o=i[0].validity;for(a in o)""===h&&"valid"!=a&&ae(o[a])&&o[a]&&d[a]&&(h=d[a]);return h||f}switch(be(u).to(1)){case"f":return c=u.call(l(i).manifest,t,r,i),null===c||void 0===c?"":c;case"r":return u.test(String(r))?"":m;case"a":return u.indexOf(r)>-1?"":m;case"s":return r==u?"":m;case"o":return u[r]?"":m;case"b":return i.hasClass("my-form-list")?(s=i.data("listSrc")||i.data("my").listSrc||">*",c={},i.find(s).filter("*:not(.ui-sortable-placeholder)").each(function(t){var r=e(this);r.data("my")&&!r.my("valid")&&(c[t]=r.my("errors"))}),c):i.hasClass("my-form")&&u?i.my("valid")?"":i.my("errors"):""}return d.formError||"Error"}return""}var B,Q="jQuery.my 1.2.2",W=window.URL||window.webkitURL,V=!document.addEventListener,X="{yyyy}-{MM}-{dd}",K="{HH}:{mm}",G="object",Y="data",Z="array",ee="string",te="function",re="change",ne=/^this\./,ie=Object.isArray,ae=Object.isBoolean,oe=Object.isString,se=Object.isObject,le=Object.isNumber,ce=Object.isRegExp,ue=Object.isFunction,de=function(e){return null!=e&&typeof e==G&&ue(e.then)},fe=s(e,"my.f.repo")?e.my.f.repo():{_src:{},_name:"Default manifest cache"},me=s(e,"my.f.restyles")?e.my.f.restyles():{},he=Object.merge,ye=Object.clone,pe=Object.keys,ve=e.extend,ge=e.Deferred,be=e.type,xe=null,we=function(e){return null!==e&&void 0!==e},ke=e.ajax,je=y,Ce=Date.now,Oe=E,ze={vals:{".my-form":function(e,t){if(e&&e.my){var r=e.my(Y);return Object.equal(r,t)?r:e.my(Y,t,!0)}return t||xe},".hasDatepicker":function(e,t){we(t)&&e.datepicker("setDate",""==t?t:Date.create(t));var r=e.datepicker("getDate");return r?r.format(X):""},".my-tags":function(e,t){return we(t)&&(oe(t)||le(t)?e.tags(Y,[t+""]):ie(t)&&e.tags(Y,t)),e.tags(Y)},".ui-draggable":function(e,t){if(we(t)&&se(t)){var r={};isNaN(t.left)||(r.left=Number(t.left).ceil(2)+"px"),isNaN(t.top)||(r.top=Number(t.top).ceil(2)+"px"),(r.left||r.top)&&e.css(r)}var n=e.position();return{left:t&&!isNaN(t.left)?(1*t.left).ceil(2):n.left.ceil(2),top:t&&!isNaN(t.top)?(1*t.top).ceil(2):n.top.ceil(2)}},".my-form-list":function(t,r){function i(){var r,n,i=e(this),a=i.data("my");a&&(r=i.data("formlist"),n=r.index,r.hash=k(a.data,n)+"",j!==k?r.oid=j(a.data,n)+"":r.oid=r.hash),t.trigger("check.my")}function a(e){e.data("my").locktill+O/1.3<S&&e.my("redraw")}var s,l,c,u,f,m,h,y=t.data("formlist")||{},v=y.generator||{},g=v.selector||">.my-form",b=!!v.merge,x=v.template||"<div></div>",w=/\{/.test(x),k=v.hash||d,j=v.id||d,C=v.ext,O=v.delay||50,z="ui-sortable",N="."+z+"-placeholder",_=t.is("."+z),q=!!t.children(N).size(),D=[],T=[],S=Ce(),E=_?t.find(t.sortable("option","items")):t.find(g);if(we(r)&&ie(r)){if(q)return r;if(l=[],c={},E.each(function(t){var r,n=e(this),i=n.data("my");i&&(l.push(i.data),!b&&(r=n.data("formlist"))&&(c[r.oid]=i.data))}),f=o(l,r,"=="),!f){var R=[],I=[],$={},F={};for(T=[],s=0;s<r.length;s++)I[s]=j(r[s],s)+"",$[I[s]]=s,R[s]=(j!==k?k(r[s],s):I[s])+"";for(E.each(function(){var t=e(this),i=t.data("formlist")||{},a=i.oid;a&&n($,a)&&(b||r[$[a]]===c[a])?F[a]=e(this):t.hasClass("my-form")?t.my("remove",!0):t.remove()}),s=0;s<r.length;s++)F[I[s]]?(m=F[I[s]].detach().appendTo(t),D.push(m.my("data")),R[s]!==(m.data("formlist")||{}).hash&&(b&&D.last()!==r[s]&&v.merge(D.last(),r[s]),T.push(m))):(m=e(w?x.assign(r[s]):x).appendTo(t),m.data("formlist",{list:r[s],index:s,hash:R[s],oid:I[s]}),M.call(m,p(v.parent,v.manifest,r[s],s,r,t),r[s]).then(function(e){e.on("change.my",i.debounce(O/1.3))}.fill(m)),D.push(m.my("data")));if(T.length&&C){for(s=0;s<T.length;s++)a(T[s]);T=[]}return l=c=u=null,D}return c=u=null,l}if(E.size()){if(S-v.stamp>1.4*O||S-v.stamp>100||!v.stashed||v.stashed.length!==E.size()-(q?1:0)){q&&(h=t.find(">."+z+"-helper"));var U=0;for(E.each(function(t,r){var n,i,a,o=e(r),s=!1;q&&o.hasClass(z+"-helper")||(q&&o.hasClass(z+"-placeholder")&&(o=h),n=o.data("my"),i=o.data("formlist"),n&&i&&(D.push(n.data),U!=i.index&&(i.index=U,s=!0),C&&(a=k(n.data,U)+"",a!==i.hash&&(i.hash=a,s=!0)),U+=1,s&&T.push(o)))}),s=0;s<T.length;s++)a(T[s]);T=[],v.stamp=S,v.stashed=D}else D=v.stashed.slice(0);return D}return r||[]},"input[type=date]":function(e,t){if(we(t))return r=""!=t?Date.create(t).format(X):"",oe(r)&&!/Invalid/.test(r)&&e.val(r),r;var r=e.val();return""!=r?Date.create(r).format(X):""},"input[type=time]":function(e,t){if(we(t))return r=""!=t?Date.create(t).format(K):"",oe(r)&&!/Invalid/.test(r)&&e.val(r),r;var r=e.val();return""!=r?Date.create(r).format(K):""},input:{"[type='text'],[type='number'],[type='search'],[type='hidden'],[type='password'],[type='button'],[type='range'],:not([type])":{".ui-slider-input":function(e,t){we(t)&&e.val(t).slider("refresh")},".tagstrip input.value":function(e,t){we(t)&&e.val(t).trigger("update")},"div.select2-container+input":function(e,t){return we(t)&&JSON.stringify(t)!==JSON.stringify(e.select2("val"))&&e.select2("val",ie(t)?t:[t]),e.select2("val")},"":function(e,t){we(t)&&e.val(t+"")}},":radio":function(t,r){var n=-1;if(we(r)){t.each(function(t){var i=e(this).val();r+""==i+""&&(n=t)});var i=t.eq(0).checkboxradio;if(i&&t.each(function(t){var r=e(this);n!=t&&r.is(":checked")&&r.prop("checked",!1).checkboxradio("refresh")}),n>-1){var a=t.eq(n);a.is(":checked")||(a.prop("checked",!0),i&&a.checkboxradio("refresh"))}else i||t.each(function(){e(this).prop("checked",!1)})}if(-1==n)for(var o=0;o<t.size();o++)t.eq(o).is(":checked")&&(n=o);return-1!=n?t.eq(n).val():""},":checkbox":function(t,r){var n=r,i=[];if(we(n)){ie(n)||(n=[r]);var a=!!t.eq(0).checkboxradio;t.each(function(t){var r=e(this),o=r.val(),s=r.is(":checked");-1!=n.indexOf(o)?(i.push(o),s||r.prop("checked",!0)):s&&r.prop("checked",!1),a&&r.checkboxradio("refresh")})}else t.each(function(){var t=e(this);t.is(":checked")&&i.push(t.val())});return i}},select:{".ui-slider-switch":function(e,t){we(t)&&(e.val(t+""),e.slider("refresh"))},"div.select2-container+select":{"[multiple]":function(e,t){return we(t)&&e.select2("val",ie(t)?t:[t]),e.select2("val")},"":function(e,t){return we(t)&&e.select2("val",t+""),e.select2("val")}},"[multiple]":function(e,t){return we(t)&&(e.val(t,[]),e.selectmenu&&(e.data("uiSelectmenu")||e.data("selectmenu"))&&e.selectmenu("refresh",!0)),e.val()||[]},"":function(e,t){we(t)&&(e.val(t+""),e.selectmenu&&(e.data("uiSelectmenu")||e.data("selectmenu"))&&e.selectmenu("refresh",!0))}},textarea:{".my-cleditor":function(e,t){return we(t)&&e.val(t).cleditor()[0].updateFrame(),e.val()},"div.redactor_box textarea,.redactor":function(e,t){var r=e.hasClass("my-redactor-9");return we(t)?(r?e.redactor("set",t):e.setCode(t,!1),t):r?e.redactor("get"):e.getCode()},".my-codemirror":function(e,t){return we(t)?(e[0].nextSibling.CodeMirror.setValue(t),t):e[0].nextSibling.CodeMirror.getValue()},"":function(e,t){we(t)&&e.val(t+"")}},"fieldset,form,section,footer,aside,.my-container":function(e,t){var r=a(e[0],0).sort(),n=t;return we(t)&&(oe(t)&&(n=t.split(/[,\s]+/).compact(!0)),ie(n)&&(n.sort(),n.join(" ")!==r.join(" ")&&(e.atrr("css",n.join(" ")),r=n))),r},"div,span":{".ui-slider":function(e,t){return we(t)&&e.slider("option",e.slider("option","values")?"values":"value",Ne.clone(t)),Ne.clone(e.slider("option","values")||e.slider("option","value")||0)},".ui-buttonset":function(t,r){if(we(r)){if(""!=r){var n=xe;if(t.find(":radio").each(function(){n=(e(this).val()||e(this).button("option","label"))==r?e(this):n}),n)return n.attr("checked",!0),t.buttonset("refresh"),r}}else{var i=t.find(":radio:checked");if(i.size()&&i.button)return i.val()||i.button("option","label")}return t.find(":radio:checked").attr("checked",!1),t.buttonset("refresh"),""},".ace_editor":function(e,t){return we(t)&&ace.edit(e[0]).setValue(t),ace.edit(e[0]).getValue(t)},"":function(e,t){return we(t)&&e.html(t),e.html()}},"a,p,li,td,th,h1,h2,h3,h4,h5,h6,pre,code":function(e,t){return we(t)&&e.html(t),e.html()},img:function(e,t){return we(t)&&e.attr("src",t),e.attr("src")||""},"":function(e,t){return we(t)&&e.html(t),e.html()||e.text()||String(e.val())||""}},msg:{"":{en:"Invalid input",ru:B="Неверное значение"},formError:{en:"Form error",ru:"Ошибка формы"},initFailed:{en:'<p class="my-error">Form init failed</p>',ru:'<p class="my-error">Ошибка инициализации формы</p>'},badInput:{en:"Invalid input",ru:B},patternMismatch:{en:"Pattern mismatch",ru:"Не соответствует шаблону"},rangeOverflow:{en:"Over maximum",ru:"Больше максимума"},rangeUnderflow:{en:"Under minimum",ru:"Меньше минимума"},stepMismatch:{
en:"Step mismatch",ru:"Не кратно шагу"},tooLong:{en:"Too long",ru:"Слишком длинно"},typeMismatch:{en:"Invalid type",ru:"Неверный тип"},valueMissing:{en:"Required",ru:"Обязательное поле"}},events:{".hasDatepicker":"change.my check.my",".my-form,.my-tags":"change.my check.my",".ui-slider":"slide.my check.my","div.redactor_box textarea":"redactor.my check.my",".my-codemirror":"codemirror.my check.my",".ace_editor":"ace.my check.my",".my-form-list":"sortupdate.my check.my",".ui-sortable":"sortchange.my sortupdate.my check.my",".ui-draggable":"drag.my dragstop.my check.my","a, .pseudolink, input[type=button], button":"click.my","img, :radio, :checkbox":"click.my check.my","div.select2-container+input,div.select2-container+select":"change.my check.my input.my",".ui-buttonset,input, select, textarea":"blur.my change.my check.my"+("Micro"===navigator.appName.to(5)?" keyup.my":" input.my"),"":"check.my"},containers:{"*[data-role='fieldcontain'] *":{"input,textarea,select,button,:radio":function(e){return e.parents('[data-role="fieldcontain"]').eq(0)}},".tagstrip *.value":function(e){return e.parents(".tagstrip").eq(0)},"div.redactor_box textarea":function(e){return e.parents("div.redactor_box").eq(0).parent()},".my-tags,.hasDatepicker,.ui-widget,input,textarea,select,button":{".my-cleditor":function(e){return e.parents("div.cleditorMain").eq(0).parent()},"":function(t){var r=t[0].parentNode,n=r.nodeName;return/^(div|span|a|p|form|fieldset|li|ul|td|th|h\d)$/i.test(n)?e(r):t.parents("div,span,a,p,form,fieldset,li,ul,td,th,h1,h2,h3,h4,h5,h6").eq(0)}},"":function(e){return e}},offon:{".ace_editor":function(e,t){ace.edit(t[0]).setReadOnly(e)},".ui-selectable":function(e,t){C(t,"selectable",e)},".ui-slider":function(e,t){C(t,"slider",e)},".ui-draggable":function(e,t){C(t,"draggable",e)},".ui-buttonset":function(e,t){C(t,"buttonset",e)},".hasDatepicker":function(e,t){C(t,"datepicker",e)},".my-form":function(e,t){t.my("disabled",!!e)},"div.select2-container+input,div.select2-container+select":function(e,t){C(t,"select2",e)},".my-cleditor":function(e,t){t.cleditor()[0].disable(!!e)},"":function(e,t){t.attr("disabled",!!e)}},destroy:{".hasDatepicker":function(e){e.datepicker("destroy")},".ui-slider":function(e){e.slider("destroy")},".ui-sortable":{".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")}),t.removeClass("my-form-list"),t.sortable("destroy")},"":function(e){e.sortable("destroy")}},".my-form-list":function(t){t.find(">.my-form").each(function(){e(this).my("remove")})},".ui-draggable":function(e){e.draggable("destroy")},".my-redactor-8":function(e){e.destroyEditor(),e.removeClass("my-redactor-8")},"div.select2-container+input,div.select2-container+select":function(e){e.select2("destroy")},".my-form":function(e){e.my("remove")},textarea:{".my-codemirror":function(e){e[0].nextSibling.CodeMirror.toTextArea(),e.removeClass("my-codemirror")}}}};ze.params={container:function(e){return $(e,ze.containers)(e)},change:xe,recalcDepth:2,delay:0,strict:!1,restyle:-1,locale:B=(navigator.language||navigator.userLanguage||"en").substr(0,2),messages:Object.map(ze.msg,function(e,t){return t[B]||t.en}),errorTip:".my-error-tip",errorCss:"my-error",animate:0,effect:function(e,t,r){return t?e.fadeIn(r):void e.fadeOut(r)},remember:0,silent:!1,history:{},historyDelay:100,loader:function(e,t){var r=ge(),n=je(e+"");return n?r.resolve(n):r.reject(null),r.promise()},ajaxTimeout:1e4};var Ne={con:r,clone:function(e){return e.clone?e.clone():e},indom:i,jquix:C,overlap:m,patch:f,kickoff:h,sdbmCode:d,tojson:function(){function e(e){return 10>e?"0"+e:e}function t(e,a,o){var s,l,c,u,d=0,f=a||0,m=n;switch(o&&oe(o)&&(d=String(o).length,m=String(o).repeat(10)),(typeof e).substr(0,3)){case"str":return i(e);case"num":return isFinite(e)?""+String(e):"null";case"boo":case"nul":return String(e);case"fun":return i(r(e.toString()));case"obj":if(!e)return"null";if(typeof e.toJSON===te)return t(e.toJSON(),f+(o?1:0),o);if(s=[],ie(e)){for(l=0;l<e.length;l+=1)s.push(t(e[l],f+(o?1:0),o)||"null");return"["+s.join(","+(o?"\n"+m.to(f*d+d):""))+"]"}for(c in e)oe(c)&&(u=t(e[c],f+(o?1:0),o),u&&s.push((o?"\n"+m.to(f*d+d):"")+t(c,f+(o?1:0),o)+": "+u));return"{"+s.join(",")+(o?"\n"+m.to(f*d):"")+"}"}}function r(e){var t=/\)([\s\n\t]+?|\/\/*.*?\*\/|\/\/[^\n]*\n)*?\{/,r=e.split(t,1),n=r[0].from(8).replace(/[\s\n\t]+?|\/\/*.*?\*\/|\/\/[^\n]*\n/g,"")+")",i="{"+e.from(r[0].length).replace(t,"").replace(/}[^}]+$/,"}");return("function "+n).replace(/^function\sanonymous/,"function ")+" "+i}Date.prototype.toJSON=function(){var t=this;return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"},RegExp.prototype.toJSON=function(){return"new RegExp("+this.toString()+")"};var n="	".repeat(10),i=JSON.stringify;return t.fill(void 0,0,void 0)}(),fromjson:function(e){var t=JSON.parse(e);return U(t),t},mask:N,unmask:_,getref:s,repo:function(){return fe},restyles:function(){return me},unjson:function(e){return U(e),e},blob2base64:function(e,t,r){var n=new FileReader;n.onload=function(){t(r?n.result:n.result.split(",")[1])},n.readAsDataURL(e)},base642blob:function(e,t,r){for(var n,i=atob(e),a=i.length,o=new ArrayBuffer(a),s=new Uint8Array(o),l=0;a>l;l++)s[l]=i.charCodeAt(l);return n=new Blob([s],{type:r||"application/octet-stream"}),ue(t)?void t(n):n},base64:function(t,r,n){var i=null,a=oe(t)?t:e.my.tojson(t),o=oe(n)?"data:"+n+";base64,":"";if(r){try{i=decodeURIComponent(escape(window.atob(a)))}catch(s){i=null}if(null!==i&&/(^".*"$)|(^\[.*\]$)|(^\{.*\}$)/.test(i))try{i=Ne.fromjson(i)}catch(s){i=null}return i}return o+window.btoa((n===!0?"ï»¿":"")+unescape(encodeURIComponent(a)))},css2json:function(e){var t=(e+"").replace(/\/\*[\s\S]+\*\//gm,"").replace(/@charset[^;]+;/gim,"").replace(/[\n\t\s]+/g," ").replace(/\}/g,"}ᴥ").replace(/^\n+/g,"").replace(/[\n\s]+$/g,"").split("ᴥ").compact(!0).reduce(function(e,t){var r,n,i,a=t.trim();return/^[^{]+\{[^\}]+\}$/.test(a)&&(r=a.to(-1).split("{"),n=" "+r[0].trim(),i=r[1].trim(),";"!=i.last()&&(i+=";"),e[n]||(e[n]=""),e[n]+=i),e},{});return t}},_e={container:function(e){return $(e,ze.containers)(e)},data:function(e,t){var r=this;return se(e)&&(r.my().data=m(r.my().data,e),this.my("redraw",t)),r.my().data},disabled:function(e){var t,r,n,i,a=this,o=a.my();if(o){if(e==xe)return o.disabled;if(e){for(r in o.ui)t=a.find(r).eq(0),n=t.my(),n&&(n.predisabled=n.disabled),j(!0,t,":disabled");a.addClass("my-disabled")}else{for(r in o.ui)t=a.find(r).eq(0),n=t.my(),i=!1,n&&n.predisabled&&(i=!0),j(i,t,":disabled");a.removeClass("my-disabled"),a.my("redraw")}}},errors:function(){var t=e(this).my().errors,r={};for(var n in t)t[n]&&oe(t[n])&&(r[n]=t[n]),se(t[n])&&pe(t[n]).length&&(r[n]=t[n]);return r},find:function(e){var t=this,r=t.my();return r&&r.root&&(t=r.root),t.find(e)},history:function(e,t){return z(e,this.my().params,t)},id:function(e,t){if(oe(e))return je(e,t);var r=this.my();return r&&r.id?r.id:xe},index:function(){var e=this.my().root&&!this.my().ddata?this.my().root:this;return(e.data("formlist")||{}).index},indom:function(){return i(this)},init:M,insert:function(e,t){var r,n,i=this.hasClass("my-form-list")?this:this.my().root||this,a=i.hasClass("my-form-list")?i:i.parent(".my-form-list"),o=(i.data("formlist")||{}).index,l=t,c=a.data("formlist").generator;if(null==o&&(o=0),r=ne.test(c.bind)?s(a.my().manifest,c.bind.replace(ne,"")):s(a.my().data,c.bind),!se(l))if(se(c.manifest))l=ye(c.manifest.data,!0)||{};else{if(a===i)throw"No data to insert, cannot guess when manifest is a function.";l=ye(i.my().manifest.data,!0)}if("before"===e)n=o;else if("after"===e)n=o+1;else{if(isNaN(e))throw"Invalid position for insertion";n=(1*e).clamp(0,r.length)}r.add(l,n),a.trigger("redraw")},manifest:function(e){return"json"==e?Ne.tojson(this.my().manifest):this.my().manifest},promise:function(e){return ue(e)&&this.my().promise.then(e),this.my().promise},radio:function(e,t){this.trigger("radio",oe(e)?{channel:e,message:t}:e)},redraw:function(e,t){var r=this,n=r.my();return n&&n.ui&&(n.ui.each(function(t){var i=r.find(t);F(i,e?xe:void 0,n.params.recalcDepth),e||(i.is(".my-form")&&i.my("redraw"),i.is(".my-form-list")?i.trigger("redraw"):i.trigger("check.my"))}),!t&&e&&r.trigger(re)),r},remove:function(e){var t,r,n,i,a,o,s,l,c=this;if(!this.my())return xe;if(this.my().root&&!this.my().ddata&&(c=this.my().root),n=c.my(),a=n.data,s=n.cid,l=n.mid,c.unbind(".my"),se(n)&&n.manifest&&ue(n.manifest.die))try{n.manifest.die.call(n.manifest,c,n.manifest)}catch(u){}if(t=n.style)if("1"==t.data("count"))try{t.remove()}catch(u){}else t.data("count",t.data("count")-1);if(r=n.localStyle)try{delete me[s],r.remove()}catch(u){}if(window.URL&&(i=n.locFiles)&&i.length)for(var d=0;d<i.length;d++)try{URL.revokeObjectURL(i[d])}catch(u){}if(o=(n||{}).ui,o&&o.each(function(e){var t,r,n,i=c.find(e);if((r=i.data("modal"))&&(r.cancel(),i.removeData("modal")),r=i.data("modals"))for(n in r)r[n]&&r[n].cancel();i.unbind(".my");try{t=$(i,ze.destroy),ue(t)&&t(i)}catch(a){}i.removeData("formlist").removeData("myval").removeData("my")}),e&&c.is(".my-form"))c.remove();else if(c.data("formlist")&&c.is(".my-form")){var f=c.parents(".my-form-list").eq(0);c.remove(),f.trigger("check")}else c.removeData("formlist").removeData("myval").removeData("my").removeClass("my-form");return c.removeClass("my-form-"+s+" my-manifest-"+l),a},reset:function(){try{h(this.my().data,this.my().initial),this.my("redraw")}catch(e){return!1}return!0},restyle:function(t){var r,n,i=[],a=this.is(".my-form")?this:this.parents(".my-form").eq(0);if(a.size()&&a.is(":visible")){for(n=(a.data("my")||{}).cid,n&&i.push(n),t||a.find(".my-restyle").each(function(){var t=e(this),r=(t.data("my")||{}).cid;r&&i.push(r)}),r=0;r<i.length;r++)if(me[i[r]])try{me[i[r]]()}catch(o){}return!!i.length}return!1},ui:function(e){var t,r=this,n=r.my(),i=[];if(!n)return xe;ve(!0,{},n.ui);if(!se(e))return n.ui;for(t in e)i.push(t);for(n.ui=D(m(n.ui,e)),t=0;t<i.length;t++)x(r.find(i[t]),r,n.ui[i[t]],i[t]);for(t in e)r.find(t).eq(0).trigger("check");return n.ui},undo:function(e){var t,r=this,n=r.my(),i=n.params.history,a=pe(i).sort(),o=1*(parseInt(e)||0);return!a.length||0>o?xe:(n.params.errors&&n.params.errors.values().compact(!0).length?Object.equal(n.data,n.lastCorrect)||(o+=1):Object.equal(i[a.last()],n.data)&&(o+=1),t=z(o,n.params,!0),t&&(h(r.my().data,t),r.my("redraw")),r.my().data)},val:function(e){return O(this,e)},valid:function(){var t=e(this).my().errors,r=0;for(var n in t)t[n]&&oe(t[n])?r++:se(t[n])&&pe(t[n]).length&&r++;return!r},version:function(){return Q}},qe=Object.keys(_e);e.my||(e.my={}),ve(e.my,{f:e.extend({},Ne),tojson:Ne.tojson,fromjson:Ne.fromjson,radio:function(t,r){w(e(document),oe(t)?{channel:t,message:r}:t)},rules:ze,ajax:function(e){return ue(e)?ke=e:ke.apply(this,a(arguments,0))},cache:function(e,t){return ue(e)?je=e:je(e,t)},now:function(e){return ue(e)?void(Ce=e):Ce()},require:function(e){return ue(e)?Oe=e:Oe.apply(this,a(arguments,0))},chain:function(){function e(){if(n.length&&i){var t,r=n.shift(),a=function(){e.delay(r[1])}.once();try{t=r[0]()}catch(o){a()}de(t)?(t.then(a,a),a.delay(r[1])):a()}}var t=1,r=1e3,n=[],i=!1,a=function(i,a,o){n.push([i,a||t,o||r]),e()};return a.delay=function(e){return isNaN(e)||(t=(e-0).clamp(0,1e6)),t},a.timeout=function(e){return isNaN(e)||(r=(e-0).clamp(1,1e6)),r},a.start=function(){i=!0,e()},a.stop=function(){i=!1},a}(),version:function(){return Q}}),e.fn.my=function(t){var r;if(void 0===t)return this.data("my");if(oe(t)&&"{"==t.substr(0,1)){try{r=JSON.parse(t)}catch(n){}if(r)return _e.init.apply(this,[r].add(a(arguments,1)))}return oe(t)&&_e[t]?_e[t].apply(this,a(arguments,1)):oe(t)&&je(t,"exist")?_e.init.apply(this,arguments):typeof t!==G&&t?void e.error("Method "+t+" does not exist on jQuery.my"):_e.init.apply(this,arguments)},e(window).off(".my").on("radio.my",function(t,r){t.stopPropagation(),w(e(document),r)}).on("resize.my",function(){for(var e in me)try{me[e]()}catch(t){}}.debounce(67))}(jQuery),function(e){function t(e,t,r){if(l(t))return e+t;if(c(t))return r=i(!0,r,t),e;if(s(t)&&t.length>1&&l(t[1])){for(var n,u,f,m,h,y,p,v,g=t[0],b="",x=1;x<t.length;){if(l(t[x]))if(m=t[x].replace(/\s/g,""),f=m.split(/[\.#]/i),u=r.alias[f[0]]||f[0],n=m.substr(f[0].length),/^[a-z0-9]+(#[a-z0-9\-_]+)?(\.[a-z0-9\-_]+)*$/i.test(m)){p=d.tmpl[u]||d.tmpl[""],y={style:"","class":"",txt:""},v="";var w=c(t[x+1]);if(w){x+=1;for(h in t[x])""!==d.attnames[h]&&(y[d.attnames[h]||h]=t[x][h])}y.style||y["class"]||!r.styles[u]||(y.style=r.styles[u]),y.id||"#"!=n.to(1)||(y.id=n.from(1).split(".")[0]),!y["class"]&&/\./.test(n)&&(y["class"]=("#"==n.to(1)?n.substr(y.id.length+1):n).split(".").compact(!0).join(" "));for(h in y)v+=h+'="'+y[h]+'" ';if(w)for(h in t[x])""===d.attnames[h]&&(y[h]=t[x][h]);y.ext=v,!y.txt&&d.txt[u]&&(y.txt=d.txt[u](y)),y._tag=u,b+=typeof p==o?p(y)||"":typeof p==a?p.assign(y):""}else b+=t[x];x+=1}return b&&(b="<"+r.rowTag+' class="'+r.rowCss+'" '+(r.row?'style="width:'+r.row+"; ":"")+(r.label&&g?"padding-left:"+r.label+"; ":"")+'">'+(g?"<"+r.labelTag+' class="'+r.labelCss+'" '+(r.label?'style="display:inline-block;width:'+r.label+";margin-left:-"+r.label+'" ':"")+">"+g+"</"+r.labelTag+">":"")+b+"</"+r.rowTag+">"),e+b}return e}function r(e){var t=e;if(l(t)&&(t=t.split(/[\s,]/).compact(!0)),s(t)){for(var r={},n=0;n<t.length;n++){var i=t[n];if(c(i)){var a=Object.keys(i);1==a.length?r[a[0]]=i[a[0]]+"":r[i.id||i.key||i.name||""]=i.text||i.value||i.title||""}else r[i]=i+""}t=r}return c(t)?t:{}}function n(r,n){var a={},o=l(r)?r.lines().map(function(e){return e.replace(/^[\t\s]*/,"")}):r;return s(o)?(i(!0,a,d.params,n||{}),o.length?o.reduce(t.fill(void 0,void 0,a),""):""):c(o)?void e.extend(d,o):""}var i=e.extend,a="string",o="function",s=Object.isArray,l=(Object.isBoolean,Object.isString),c=Object.isObject,u=(Object.isNumber,Object.isRegExp,Object.isFunction,'<input type="'),d={tmpl:{num:u+'number" {ext}/>',inp:u+'text" {ext}/>',sli:u+'range" {ext}/>',dat:u+'date" {ext}/>',btn:u+'button" {ext}/>',pwd:u+'password" {ext}/>',but:"<button {ext}>{txt}</button>",div:"<div {ext}>{txt}</div>",spn:"<span {ext}>{txt}</span>",sel:"<select {ext}>{txt}</select>",mul:'<select {ext} multiple="multiple">{txt}</select>',txt:"<textarea {ext}>{txt}</textarea>",err:' <span class="my-error-tip {class}" style="{style}">{txt}</span>',msg:'<div class="my-error-tip {class}" style="{style}">{txt}</div>',val:function(e){if(!s(e.vals))return"";var t=i({style:"",css:""},e);return t.txt=e.vals.reduce(function(e,t){return e+"<span class=\"my-shortcut\" onclick=\"$(this).parents('.my-row').find('input,textarea').val($(this).text()).trigger('blur')\">"+t+"</span> "}," "),'<span class="my-shortcuts {css}" style="{style}">{txt}</span>'.assign(t)},"":"<{_tag} {ext}>{txt}</{_tag}>"},txt:{sel:function(e){if(!e.vals)return"";var t=r(e.vals);return Object.keys(t).reduce(function(e,r){return e+'<option value="'+r+'">'+t[r]+"</option>"},"")}},params:{styles:{num:"width:30%;",dat:"width:30%;",inp:"width:100%",pwd:"width:100%",but:"width:30%",txt:"width:100%;max-width:100%;min-height:1px;word-break:break-word;",err:"display:none",msg:"display:none"},alias:{number:"num",date:"dat",slider:"sli",textarea:"txt",input:"inp",span:"spn",select:"select",vals:"val"},row:"",rowTag:"div",rowCss:"my-row",label:"",labelTag:"span",labelCss:"my-label"},defaults:{id:"","class":"",style:"",placeholder:"",value:"",rows:1},attnames:{css:"class",plc:"placeholder",val:"value",txt:"",vals:"",tip:"title"}},f={init:function(t,r){return e(this).html(n(t,r))}};e.my||(e.my={}),e.my.formgen=n,e.fn.formgen=function(t){return l(t)&&f[t]?f[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist on jQuery.formgen"):f.init.apply(this,arguments)}}(jQuery),function(e){function t(t,r,n,i){var a,s,l,c,f,m,h;if("object"==typeof r&&r.jquery)r.is("img")&&(m=r,f=r.attr("alt")||r.attr("title")||r.data("text")||"",s=m[0].naturalWidth||m[0].width,a=m[0].naturalHeight||m[0].height,1>a&&(a=1),1>s&&(s=1),c=e(window).width()-90,l=e(window).height()-90,a>l&&(s=s*(l/a)|0,a=l),s>c&&(s=c,a=a*(c/s)|0),h=300>s?300:s,o(t,{source:"image",manifest:{init:function(e){e.html(this.HTML),e.on("click.my","img:eq(0)",function(){e.trigger("cancel")})},HTML:'<img src="" class="db" style="max-width:'+s+"px;max-height:"+a+'px"><h4 class="mt10"></h4>',ui:{"img:eq(0)":"img",h4:{bind:"text",css:{hide:function(e,t){return!t}}}}},data:{img:m.attr("src"),text:f},esc:!0,screen:!0,width:i||h,focus:!1,global:!0,z:"1995"},n));else if(d(r)&&r.manifest)o(t,r,n);else{if(!u(r))return null;o(t,{source:"html",manifest:{init:function(e){e.html(this.HTML)},HTML:r,ui:{"div:eq(0)":function(){}}},data:{},esc:!0,focus:!1,width:i},n)}return t}var r,n={},i="body",a=!1,o=e.extend,s={},l=e.my.f.indom,c=(Object.isArray,Object.isBoolean),u=Object.isString,d=Object.isObject,f=Object.isNumber,m=(Object.isRegExp,Object.isFunction);if(e(document).off(".modal"),e(document).on("keydown.modal",function(e){var t,r,n=e.keyCode;if(!1!==a&&(13===n||27===n)){if(r=a.data("modal"),t=r.form,27==n&&(r.esc||Object.equal(t.data("my").initial,t.my("data"))))return a.modal(!0),!1;if(13==n&&r.enter)return function(e){e.modal()}.fill(a).delay(50),!1}}),m(e.my.f.getref(e,"my.modal.parent"))){var h=e.my.f.getref(e,"my.modal.parent")().attr("id");h&&(i="#"+h)}n.modal=function(r,n,o){var s,l={},u=e(i),d=u.find(">.my-modal-proxy"),f={global:!0,screen:!0,done:m(n)?n:void 0,z:"1995"};return c(r)||null==r?d.modal(r):(s=e.Deferred(),t(l,r,f,o)?a?s.reject("Locked").promise():(d.size()||(d=e('<div class="my-modal-proxy"></div>').prependTo(u),d.css({position:"absolute",top:"0",left:"0",margin:"0",padding:"0",width:"1px",height:"0"})),d.modal(l)):s.reject("Invalid data").promise())},n.modal.loading=function(t){e(i).find(">.my-modal").toggleClass("my-modal-loading",!!t)},n.modal.parent=function(t){return t&&e(t).size()?void(i=t):e(i)},n.modal.parentBack=function(t){return t&&e(t).size()?void(r=t):e(r||i)},n.modal.visible=function(){return!!a},e.my||(e.my={}),e.my.modal=n.modal,e.fn.modal=function(n,h,y){function p(){var t,r,n=window,i=!!M.global,a=k.offset(),o=q.offset(),s=k.scrollTop();M.pos={px:a.left,py:a.top,pw:k.outerWidth(),ph:k.outerHeight(),ox:o.left,oy:o.top,ow:q.outerWidth(),oh:q.outerHeight(),ww:r,wh:t};var l=1*(M.x.match(/\-?\d+(\.\d+)?/)||[0])[0],c=1*(M.y.match(/\-?\d+(\.\d+)?/)||[0])[0],u=M.x.has("left")?-1:M.x.has("right")?1:0,d=M.y.has("top")?-1:M.y.has("bottom")?1:0,m=M.pos.ox+M.pos.ow/2-M.pos.px,h=M.pos.oy+M.pos.oh/2-M.pos.py;if(i&&(M.pos.wh=t=n.innerHeight||e(n).height(),M.pos.ww=r=n.innerWidth||e(n).width(),m=r/2,h=t/2.5),l=M.x.has("%")?M.pos.ow/100*l:l,c=M.y.has("%")?M.pos.oh/100*c:c,M.pos.pix=m,M.pos.piy=h,m=m+u*(M.pos.ow/2)+l*(u>0?-1:1)-(M.width+D)*(u+1)/2,i?(h=(t-M.height-20)/3,10>h&&(h=10)):h=h+d*(M.pos.oh/2)+c*(d>0?-1:1)-(M.height||0)*(d+1)/2,m=m.round(1),h=(h+s).round(1),M.pos.vx=m,M.pos.vy=h,M.bound!==!1&&!M.global){var y=(f(M.bound)?M.bound:0).clamp(-100,100);M.pos.pw-2*y<M.width+D?M.pos.vx=-(M.width+D-M.pos.pw)/2:M.pos.vx+M.width+D>M.pos.pw-y?M.pos.vx=M.pos.pw-y-M.width-D:M.pos.vx<y&&(M.pos.vx=y),M.pos.ph-2*y<M.height?(M.pos.vy=y,M.height=M.pos.ph-2*y):M.pos.vy+M.height>M.pos.ph-y?M.pos.vy=M.pos.ph-y-M.height:M.pos.vy<y&&(M.pos.vy=y)}}function v(t){if(t||(M.height=x.outerHeight(),"manifest"!==M.source&&(M.width=x.width()),p()),x.css({width:M.width+D+"px",display:"block"}),M.global)x.css({left:"50%","margin-left":"-"+((M.width+D)/2).round(0)+"px"});else if(x.css({left:M.pos.vx+"px"}),M.nose){e("style#my-modal-style-"+M.cid).size()||x.append('<style id="my-modal-style-'+M.cid+'"></style>');var r="",n=e("style#my-modal-style-"+M.cid);("top"==M.nose||"bottom"==M.nose)&&(r+="div.my-modal-"+M.cid+".nose-"+M.nose+":before {left:"+(M.pos.ox-M.pos.px+M.pos.ow/2-M.pos.vx)+"px!important;}",n.text(r)),("left"==M.nose||"right"==M.nose)&&(r+="div.my-modal-"+M.cid+".nose-"+M.nose+":before {top:"+(M.pos.oy-M.pos.py+M.pos.oh/2-M.pos.vy)+"px!important;}",n.text(r))}M.screen?M.global?(j.css({top:0,left:0,width:"100%",height:"100%",display:"block",position:"fixed","z-index":M.z-1}),u(M.screen)&&j.css({background:M.screen?M.screen:"rgba(25, 39, 59, 0.88)"})):j.css({top:0,left:0,position:"absolute",width:M.pos.pw+"px",height:M.pos.ph+"px",display:"block",background:u(M.screen)?M.screen:"rgba(40,80,120,0.6)","z-index":M.z-1}):j.size()&&j.hide(),M.height>M.pos.wh?(x.height(M.pos.wh-30),w.css({"overflow-y":e.browser.webkit?"overlay":"scroll"})):w.css({"overflow-y":"none"}),x.animate({top:M.pos.vy+"px",opacity:"1"},M.animate)}function g(){try{w.my("remove")}catch(t){}try{k.data("modals")[M.cid]=null}catch(t){}w.parent().unbind(".my").remove(),j.off(".my"+M.cid),M.screen&&function(e){e&&a||j.hide(),e&&!a&&j.css({background:"rgba(25, 39, 59, 0.88)"})}.delay(50,M.global),M.global&&(a=!1,e("body")[0].style.overflow=null)}function b(e){try{S(null,null)}catch(t){}(function(){N.reject(e)}).delay(0)}var x,w,k,j,C,O,z,N=e.Deferred(),_={},q=this,D=0,T=0,S=m(h)?h:function(){return!1},E=d(n)?n:{},M=q.data("modal");if(o(q,N.promise()),M){if(null==n||c(n)){if(w=M.form,j=M.bg,k=M.root,S=M.done,O=w.my("data"),z=!1,n){try{S.call(w.my("manifest"),null,null)}catch(R){}try{l(w)?g():""}catch(R){}if(q.removeData("modal"),s[M.cid])try{s[M.cid].reject("Cancelled")}catch(R){}delete s[M.cid],M=null}else{try{z=S.call(w.my("manifest"),w.my("valid")?null:w.my("errors"),O)}catch(R){}if(!z){try{l(w)?g():""}catch(R){}q.removeData("modal"),function(){s[M.cid]&&s[M.cid].resolve(O),delete s[M.cid],M=null}.delay(0)}}return q}if(E)return b("Locked"),q}return q.is(":visible")?(E=t(_,n,{}))?E.global&&a?(b("Locked"),q):(M=o({type:"DOM",source:"manifest",form:null,modal:null,root:null,bgroot:null,caller:q,manifest:{},data:{},global:!1,screen:!1,drag:!1,focus:!0,close:!0,silent:!0,esc:!1,enter:!1,bound:!1,hardClose:!0,nose:"",width:y||300,height:null,x:"0",y:"0",z:"1901",background:"white",css:"",animate:200},E,{promise:N.promise(),cid:Number.random(268435456,4294967295).toString(16)}),M.done=m(M.done)?M.done:S,u(M.align)&&M.align&&(M.x=(M.align.match(/(left|right):\-?\d+(\.\d+)?(%|px)?/g)||["0"])[0],M.y=(M.align.match(/(top|bottom):\-?\d+(\.\d+)?(%|px)?/g)||["0"])[0]),M.width=1*(e.my.f.getref(u(M.manifest)?e.my.cache(M.manifest):M.manifest,"params.width")||M.width),M.type="DOM",q.hasClass("my-form")?(M.type="form",M.root=M.root||q):q.data("my")?(M.type="control",M.root=M.root||q.my().root):(M.root=M.root||q.parents(".my-form").eq(0),M.root.size()||(M.root=e(i))),M.global?(M.root=e(i),M.bgroot=e(r||i)):M.bgroot=M.root,k=M.root,k.data("modals")||k.data("modals",{}),p(),x=e('<div class="my-modal my-modal-'+(M.global?"fullscreen ":"overlay ")+M.css+(M.nose?" nose-"+M.nose:"")+'"></div>'),M.root.find(">.my-modal").size()?x.insertAfter(M.root.find(">.my-modal").last()):x.prependTo(M.root),x.addClass("my-modal-"+M.cid),D=x.outerWidth(),T=x.outerHeight(),x.hide(),x.html('<div class="my-modal-form"></div>'),w=x.find(".my-modal-form"),M.close&&(C=e(u(M.close)?M.close:'<div class="my-modal-close" title="Close">×</div>').prependTo(x).on("click.my",function(){q.modal(M.hardClose)}),C.css({"z-index":("+"===(M.z+"").to(1)?"+":"")+(1*M.z+1)})),j=M.bgroot.find(">.my-modal-screen"),M.screen&&(j.size()||(j=e('<div class="my-modal-screen" style="display:none;"></div>').prependTo(M.root)),M.esc&&j.on("click.my"+M.cid,function(){q.modal(!0)})),q.data("modal",M),M.silent&&x.on("change.my",function(){return!1}),x.css({display:"block",height:"none",opacity:"0.005","z-index":M.z,width:"auto"}),M.global?x.css({position:"fixed",left:"50%",top:M.pos.vy+"px",display:"block",height:"none",opacity:"0.005","z-index":M.z,width:"auto","margin-left":"-"+((M.width+D)/2).round(0)+"px"}):x.css({position:"absolute",left:M.pos.vx+"px",top:M.pos.vy+"px",display:"block",height:"none",opacity:"0.005","z-index":M.z,width:"auto"}),w.my(M.manifest,M.data).then(function(){var t,r,n,i,l;if(o(M,{form:w,bg:j,cancel:function(){q.modal(!0)},commit:function(){q.modal()}}),x.data("modal",M),M.height=x.outerHeight(),"manifest"!==M.source&&(M.width=x.width()),p(),x.css({top:M.pos.vy+"px"}),v(!0),k.data("modals")[M.cid]=M,s[M.cid]=N,w.bind("commit.my",function(){return M.commit.delay(50),!1}).bind("cancel.my",function(){return M.cancel.delay(50),!1}),x.bind("layout.my",function(){v()}.debounce(50)),M.global&&(a=q,e("body").css({overflow:"hidden"})),M.global||!M.esc&&!M.enter||w.bind("keydown.my",function(t){var r=t.keyCode;return 27==r&&M.esc?(M.cancel(),!1):13==r&&M.enter&&!e(t.target).is("textarea")?(M.commit.delay(50),!1):void 0}),M.focus===!0){i=!1,l=M.manifest.ui;for(n in l)i||(r=w.find(n),r.size()&&r.is("input, textarea","button")&&(i=!0,r.focus()))}else u(M.focus)&&w.find(M.focus).focus();if(t=w.find("img").filter(function(){return""!=e(this).attr("src")}),t.size()){var c=function(){"manifest"!==M.source&&x.css({width:"auto"}),v()}.after(t.size());t.each(function(){e(this).bind("load",c)})}M.drag&&e.fn.draggable&&(u(M.drag)?x.draggable({handle:M.drag}):x.draggable(),M.nose&&x.on("dragstart.my",function(){x.removeClass("nose-"+M.nose)})),N.notify("Ready")}).fail(function(e){try{g()}catch(t){}q.data("modal",null),N.reject(e)}),q):(b("Invalid data"),q):(b("Object must be visible"),q)}}(jQuery);